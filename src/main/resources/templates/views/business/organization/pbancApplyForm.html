<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/default_layout}">
<body>
<div layout:fragment="content" data-menu="business-2">
    <div sec:authorize="isAuthenticated()">
        <div class="title">
            <h2>사업신청 관리</h2>
        </div>

        <h3 class="subTitle">사업신청 수정</h3>
        <div class="tableLeftResponsive">
            <table class="tableLeft">
                <colgroup>
                    <col style="width: 200px">
                    <col style="width: auto">
                    <col style="width: 200px">
                    <col style="width: auto">
                </colgroup>
                <tbody>
                <tr>
                    <th scope="row">사업명</th>
                    <td>
                        <span class="d-none" id="bizPbancNo" th:text="${content[0].bizPbancMaster.bizPbancNo}"></span>
                        <span id="bizPbancNm" th:text="${content[0].bizPbancMaster.bizPbancNm}">사업명</span>
                        <button class="btn btnDefault ms-2" onclick="checkPbanc()">변경 확인</button>
                    </td>
                    <th scope="row">년도</th>
                    <td th:text="${content[0].bizPbancMaster.bizPbancYr}">2022</td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>사용자 정보</th>
                    <td>
                        <div class="d-flex align-items-center gap-2">
                            <input type="text" class="hp_w200" id="bizOrgAplyPic" th:value="${content[0].bizOrgAplyPic}" disabled>
                            <button type="button" onclick="findOrgUser()" class="btn btnDefault">검색</button>
                        </div>
                    </td>
                    <th scope="row">사업자등록번호(고유번호)</th>
                    <td>
                        <input type="text" class="hp_w200" id="bizLicenseNumber" th:value="${content[0].organizationInfo.bizLicenseNumber}" disabled>
                    </td>
                </tr>
                <tr>
                    <th scope="row">학교/기관 구분</th>
                    <td colspan="3">
                        <span th:if="${content[0].organizationInfo.organizationType == '1'}">매체사</span>
                        <span th:if="${content[0].organizationInfo.organizationType == '2'}">기관</span>
                        <span th:if="${content[0].organizationInfo.organizationType == '3'}">학교</span>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span th:if="${content[0].bizPbancMaster.bizPbancType==2||content[0].bizPbancMaster.bizPbancType==3}" class="el_required">*</span>수업형태</th>
                    <td>
                        <select th:if="${content[0].bizPbancMaster.bizPbancType==2||content[0].bizPbancMaster.bizPbancType==3}" class="common_select hp_w200" id="bizOrgAplyOperMeth" not_null="true" alert_name="수업형태" onchange="methEtc(this.value)">
                            <option value="교과수업" th:selected="${#strings.startsWith(content[0].bizOrgAplyOperMeth, '교과수업')}">교과수업</option>
                            <option value="동아리" th:selected="${content[0].bizOrgAplyOperMeth =='동아리'}">동아리</option>
                            <option value="진로" th:selected="${#strings.startsWith(content[0].bizOrgAplyOperMeth, '진로')}">진로수업</option>
                            <option value="자율수업" th:selected="${content[0].bizOrgAplyOperMeth =='자율수업'}">자율수업</option>
                            <option value="자유학기제" th:selected="${content[0].bizOrgAplyOperMeth =='자유학기제'}">자유학기제</option>
<!--                            <option value="방과후" th:selected="${content[0].bizOrgAplyOperMeth =='방과후'}">방과후</option>--><!-- 추가 예정 -->
                            <option value="기타" th:selected="${content[0].bizOrgAplyOperMeth =='기타'}">기타</option>
                        </select>
                        <th:block th:if="${(content[0].bizPbancMaster.bizPbancType==2||content[0].bizPbancMaster.bizPbancType==3) &&
                                (#strings.startsWith(content[0].bizOrgAplyOperMeth, '교과수업') || #strings.startsWith(content[0].bizOrgAplyOperMeth, '기타'))}">
                            <th:block th:if="${#strings.startsWith(content[0].bizOrgAplyOperMeth, '교과수업_')}">
                                <input type="text" class="hp_w200" id="bizOrgAplyOperMethEtc" placeholder="(선택)25자 이내"
                                       th:value="${#strings.replace(content[0].bizOrgAplyOperMeth, '교과수업_', '')}">
                            </th:block>
                            <th:block th:if="${#strings.startsWith(content[0].bizOrgAplyOperMeth, '기타_')}">
                                <input type="text" class="hp_w200" id="bizOrgAplyOperMethEtc" placeholder="(선택)25자 이내"
                                       th:value="${#strings.replace(content[0].bizOrgAplyOperMeth, '기타_', '')}">
                            </th:block>
                            <th:block th:unless="${#strings.startsWith(content[0].bizOrgAplyOperMeth, '교과수업_') || #strings.startsWith(content[0].bizOrgAplyOperMeth, '기타_')}">
                                <input type="text" class="hp_w200" id="bizOrgAplyOperMethEtc" placeholder="(선택)25자 이내">
                            </th:block>
                        </th:block>
                        <div th:unless="${content[0].bizPbancMaster.bizPbancType==2||content[0].bizPbancMaster.bizPbancType==3}">
                            <span>-</span>
                            <input id="bizOrgAplyOperMeth" type="hidden" value="-">
                            <input id="bizOrgAplyOperMethEtc" type="hidden" value="-">
                        </div>
                    </td>
                    <th scope="row"><span class="el_required">*</span>교육기간</th>
                    <td>
                        <div class="bl_dateRange">
                            <input type="text" id="date1" class="el_datePicker sdate" disabled>
                            <span class="blank">~</span>
                            <input type="text" id="date2" class="el_datePicker edate" disabled>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th scope="row">소속학교/기관</th>
                    <td>
                        <div class="d-flex-2">
                            <div class="d-flex-1">
                                <input type="text" class="hp_w200" id="organizationName" th:value="${content[0].organizationInfo.organizationName}" disabled>
                            </div>
                        </div>
                    </td>
                    <th scope="row"><span class="el_required">*</span>대표자</th>
                    <td>
                        <input id="bizOrgAplyRprsvNm" type="text" class="hp_w200" th:value="${content[0].bizOrgAplyRprsvNm}" not_null="true" alert_name="대표자">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>총 교육시간</th>
                    <td>
                        <input id="bizOrgAplyTime" type="text" class="hp_w200" th:value="${content[0].bizOrgAplyTime}" disabled>
                    </td>
                    <th scope="row"><span class="el_required">*</span>최초 총 교육시간</th>
                    <td>
                        <input id="bizOrgAplyTimeFrst" type="text" class="hp_w200" th:value="${content[0].bizOrgAplyTimeFrst}" disabled>
                        <button class="btn btnDefault ms-2" onclick="toggleTime()">수정</button>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>담당자 이름(직급)</th>
                    <td>
                        <div class="d-flex-1">
                            <input type="text" id="bizOrgAplyPicNm" th:value="${content[0].bizOrgAplyPicNm}" class="hp_w150" not_null="true" alert_name="담당자 이름" disabled>
                            <input type="text" id="bizOrgAplyPicJbgd" th:value="${content[0].bizOrgAplyPicJbgd}" class="hp_w150" not_null="true" alert_name="담당자 직급">
                        </div>
                    </td>
                    <th scope="row"><span class="el_required">*</span>담당자 이메일</th>
                    <td>
                        <input id="bizOrgAplyPicEml" type="text" th:value="${content[0].bizOrgAplyPicEml}" class="hp_w200" not_null="true" alert_name="담당자 이메일">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>담당자 전화번호</th>
                    <td>
                        <input id="bizOrgAplyPicTelno" type="text" th:value="${content[0].bizOrgAplyPicTelno}" class="hp_w200" not_null="true" alert_name="담당자 전화번호">
                    </td>
                    <th scope="row"><span class="el_required">*</span>담당자 휴대폰</th>
                    <td>
                        <input id="bizOrgAplyPicMpno" type="text" th:value="${content[0].bizOrgAplyPicMpno}" class="hp_w200" not_null="true" alert_name="담당자 휴대폰">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>수업시간표</th>
                    <td colspan="3">
                        <div class="tableResponsive overflowMulti mb-0">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th scope="col">회차</th>
                                    <th scope="col">수업일정</th>
                                    <th scope="col">수업주제</th>
                                    <th scope="col">수업시수</th>
                                    <th scope="col">시작시간</th>
                                    <th scope="col">종료시간</th>
                                    <th scope="col">인원(명)</th>
                                    <th scope="col">수업장소</th>
                                    <th scope="col">비고</th>
                                    <th scope="col">강사</th>
                                    <th scope="col">관리</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="dtl_list" id="target" th:each="item,stat:${content[0].bizOrganizationAplyDtls}">
                                    <td>
                                        <input type="hidden" class="hp_w120 bizOrgAplyDtlNo" th:value="${item.bizOrgAplyDtlNo}">
                                        <input type="hidden" class="hp_w120 bizOrgAplyDtlIndex" th:value="${stat.index}">
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlRnd" th:value="${item.bizOrgAplyLsnDtlRnd}" not_null="true" alert_name="수업시간표 회차" reg_type="int">

                                    </td>
                                    <td>
                                        <input type="text" class="hp_w150 el_datePicker bizOrgAplyLsnDtlYmd" th:value="${item.bizOrgAplyLsnDtlYmd}" not_null="true" alert_name="수업시간표 수업일정" reg_type="date">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w150 bizOrgAplyLsnDtlTpic" th:value="${item.bizOrgAplyLsnDtlTpic}" not_null="true" alert_name="수업시간표 수업주제">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlHr"  oninput="this.value=this.value.replace(/[^-0-9]/g,'');" th:value="${item.bizOrgAplyLsnDtlHr}"  not_null="true" alert_name="수업시간표 수업시수">
                                    </td>
                                    <td>
                                        <div class="time_select">
                                            <select class="common_select bgng1" th:id="${'startHour' + stat.index}" data-list="hourList"  not_null="true" alert_name="수업시간표 시작시간"></select>
                                            <select class="common_select bgng2" th:id="${'startMin' + stat.index}" data-list="minuteList" not_null="true" alert_name="수업시간표 시작시간"></select>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="time_select">
                                            <select class="common_select end1" th:id="${'endHour' + stat.index}" data-list="hourList" not_null="true" alert_name="수업시간표 종료시간"></select>
                                            <select class="common_select end2" th:id="${'endMin' + stat.index}" data-list="minuteList" not_null="true" alert_name="수업시간표 종료시간"></select>
                                        </div>
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlNope" th:value="${item.bizOrgAplyLsnDtlNope}" not_null="true" alert_name="수업시간표 수업인원" reg_type="int">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlPlc" th:value="${item.bizOrgAplyLsnDtlPlc}" not_null="true" alert_name="수업시간표 수업장소">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w150 bizOrgAplyLsnDtlEtc" th:value="${item.bizOrgAplyLsnDtlEtc}">
                                    </td>
                                    <td th:if="${#lists.isEmpty(item.bizInstructorAsgnms)}">-</td>
                                    <td th:unless="${#lists.isEmpty(item.bizInstructorAsgnms)}">
                                        <span th:text="${item.bizInstructorAsgnms[#lists.size(item.bizInstructorAsgnms)-1].bizInstructorAply != null ? item.bizInstructorAsgnms[#lists.size(item.bizInstructorAsgnms)-1].bizInstructorAply.bizInstrAplyInstrNm : ''}">홍길동</span>
                                    </td>
                                    <td>
                                        <div href="javascript: void(0)" class="btn_type3 btn_add" onclick="addField(this)">추가</div>
                                        <div href="javascript: void(0)" class="btn_type3 btn_del" onclick="delField(this)">삭제</div>
                                    </td>
                                </tr>
                                <tr class="dtl_list" id="target" th:if="${#lists.isEmpty(content[0].bizOrganizationAplyDtls)}">
                                    <td>
                                        <input type="hidden" class="hp_w120 bizOrgAplyDtlNo"  value="">
                                        <input type="hidden" class="hp_w120 bizOrgAplyDtlIndex"  value="">
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlRnd" value="1" not_null="true" alert_name="수업시간표 회차" reg_type="int">

                                    </td>
                                    <td>
                                        <input type="text" class="hp_w150 el_datePicker bizOrgAplyLsnDtlYmd" not_null="true" alert_name="수업시간표 수업일정" reg_type="date">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w150 bizOrgAplyLsnDtlTpic" not_null="true" alert_name="수업시간표 수업주제">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlHr"  oninput="this.value=this.value.replace(/[^-0-9]/g,'');" not_null="true" alert_name="수업시간표 수업시수">
                                    </td>
                                    <td>
                                        <div class="time_select">
                                            <select class="common_select bgng1" data-list="hourList"  not_null="true" alert_name="수업시간표 시작시간"></select>
                                            <select class="common_select bgng2" data-list="minuteList" not_null="true" alert_name="수업시간표 시작시간"></select>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="time_select">
                                            <select class="common_select end1" data-list="hourList" not_null="true" alert_name="수업시간표 종료시간"></select>
                                            <select class="common_select end2" data-list="minuteList" not_null="true" alert_name="수업시간표 종료시간"></select>
                                        </div>
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlNope" not_null="true" alert_name="수업시간표 수업인원" reg_type="int">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w120 bizOrgAplyLsnDtlPlc" not_null="true" alert_name="수업시간표 수업장소">
                                    </td>
                                    <td>
                                        <input type="text" class="hp_w150 bizOrgAplyLsnDtlEtc">
                                    </td>
                                    <td>(미배정)</td>
                                    <td>
                                        <div href="javascript: void(0)" class="btn_type3 btn_add" onclick="addField(this)">추가</div>
                                        <div href="javascript: void(0)" class="btn_type3 btn_del" onclick="delField(this)">삭제</div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th scope="row">주소</th>
                    <td colspan="3">
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex align-items-center gap-2">
                                <input type="text" class="hp_w400" th:value="${content[0].organizationInfo.organizationZipCode}" disabled>
                            </div>
                            <input type="text" class="hp_w600" th:value="${content[0].organizationInfo.organizationAddress1}" disabled>
                            <input type="text" class="hp_w600" th:value="${content[0].organizationInfo.organizationAddress2}" disabled>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th scope="row">
                        <span class="el_required">*</span>
                        지역
                    </th>
                    <td th:colspan="${content[0].bizPbancMaster.bizPbancType == 1? 1 : 3}">
                        <select id="selectRegion" class="common_select" data-list="regionList" not_null="true" alert_name="지역"></select>
                    </td>
                    <th scope="row" th:if="${content[0].bizPbancMaster.bizPbancType == 1}">
                        <span class="el_required">*</span>
                        회차당 교육인원
                    </th>
                    <td th:if="${content[0].bizPbancMaster.bizPbancType == 1}">
                        <input type="text" id="bizOrgAplyLsnPlanNope" class="hp_w100" th:value="${content[0].bizOrgAplyLsnPlanNope}"  not_null="true" alert_name="회차당 교육인원" reg_type="int">
                    </td>
                </tr>
                <div th:if="${content[0].bizPbancMaster.bizPbancType == 1}">
                    <tr>
                        <th scope="row">
                            <span class="el_required">*</span>
                            신청유형
                        </th>
                        <td colspan="3">
                            <div class="chk_box item_chk">
                                <input id="type1" type="checkbox" name="applicationType" value="유아" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'유아')}">
                                <label for="type1">
                                    <span></span>
                                    유아
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type2" type="checkbox" name="applicationType" value="초등학생" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'초등학생')}">
                                <label for="type2">
                                    <span></span>
                                    초등학생
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type3" type="checkbox" name="applicationType" value="중학생" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'중학생')}">
                                <label for="type3">
                                    <span></span>
                                    중학생
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type4" type="checkbox" name="applicationType" value="고등학생" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'고등학생')}">
                                <label for="type4">
                                    <span></span>
                                    고등학생
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type5" type="checkbox" name="applicationType" value="성인" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'성인')}">
                                <label for="type5">
                                    <span></span>
                                    성인
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type6" type="checkbox" name="applicationType" value="학부모" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'학부모')}">
                                <label for="type6">
                                    <span></span>
                                    학부모
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type7" type="checkbox" name="applicationType" value="노년층" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'노년층')}">
                                <label for="type7">
                                    <span></span>
                                    노년층
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type8" type="checkbox" name="applicationType" value="소외계층" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'소외계층')}">
                                <label for="type8">
                                    <span></span>
                                    정보취약계층(장애인, 다문화 등)
                                </label>
                            </div>
                            <div class="chk_box item_chk">
                                <input id="type9" type="checkbox" name="applicationType" value="북한이탈주민" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ','),'북한이탈주민')}">
                                <label for="type9">
                                    <span></span>
                                    북한이탈주민
                                </label>
                            </div>
                            <div class="chk_box">
                                <input id="type11" type="checkbox" name="applicationType" value="기타:" th:checked="${#lists.size(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ':')) == 2}">
                                <label for="type11">
                                    <span></span>

                                </label>
                            </div>
                            <span th:if="${#lists.size(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ':')) == 2}">
                                <input placeholder="기타" class="hp_w120" type="text" id="type10" name="applicationType" th:value="${#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ':')[1]}">
                            </span>
                            <span th:unless="${#lists.size(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, ':')) == 2}">
                                <input placeholder="기타" class="hp_w120" type="text" id="type10" name="applicationType" >
                            </span>
                        </td>
                    </tr>
                </div>
                <tr th:if="${content[0].bizPbancMaster.bizPbancType==2||content[0].bizPbancMaster.bizPbancType==3}">
                    <th scope="row">
                        <span class="el_required">*</span>
                        신청유형
                    </th>
                    <td colspan="3">
                        <div class="radio_box">
                            <input id="trgtKin" type="radio" name="trgt" value="유치원_" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, '_'),'유치원')}">
                            <label for="trgtKin">
                                <span></span>
                                유치원
                            </label>
                        </div>
                        <div class="radio_box">
                            <input id="trgtEl" type="radio" name="trgt" value="초등학교_" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, '_'),'초등학교')}">
                            <label for="trgtEl">
                                <span></span>
                                초등학교
                            </label>
                        </div>
                        <div class="radio_box">
                            <input id="trgtMid" type="radio" name="trgt" value="중학교_" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, '_'),'중학교')}">
                            <label for="trgtMid">
                                <span></span>
                                중학교
                            </label>
                        </div>
                        <div class="radio_box">
                            <input id="trgtHigh" type="radio" name="trgt" value="고등학교_" th:checked="${#arrays.contains(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, '_'),'고등학교')}">
                            <label for="trgtHigh">
                                <span></span>
                                고등학교
                            </label>
                        </div>
                    </td>
                </tr>
                <tr th:unless="${content[0].bizPbancMaster.bizPbancType == 1}">
                    <th scope="row">
                        <span class="el_required">*</span>
                        수업대상학년
                    </th>
                    <td>
                        <input type="text"  class="hp_w120" id="bizOrgAplyLsnPlanTrgt" th:value="${#lists.size(#strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, '_'))==2 ? #strings.arraySplit(content[0].bizOrgAplyLsnPlanTrgt, '_')[1] :content[0].bizOrgAplyLsnPlanTrgt}" not_null="true" alert_name="수업대상학년">
                    </td>
                    <th scope="row">
                        <span class="el_required">*</span>
                        회차당 교육인원
                    </th>
                    <td>
                        <input type="text"  class="hp_w100" id="bizOrgAplyLsnPlanNope" th:value="${content[0].bizOrgAplyLsnPlanNope}" not_null="true" alert_name="회차당 교육인원" reg_type="int">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>우리 학교/기관만의 특성과 추구하는 교육의 방향성 및 신청한 이유</th>
                    <td colspan="3">
                        <textarea id="bizOrgAplyLsnPlanDscr1" cols="30" rows="10" th:text="${content[0].bizOrgAplyLsnPlanDscr1}" not_null="true" alert_name="교육의 방향성 및 신청한 이유"></textarea>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>미디어교육 운영 현황</th>
                    <td colspan="3">
                        <textarea id="bizOrgAplyLsnPlanDscr2" cols="30" rows="10" th:text="${content[0].bizOrgAplyLsnPlanDscr2}" not_null="true" alert_name="미디어교육 운영 현황"></textarea>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><span class="el_required">*</span>향후 활용계획 및 수업을 통한 기대효과</th>
                    <td colspan="3">
                        <textarea id="bizOrgAplyLsnPlanDscr3" cols="30" rows="10" th:text="${content[0].bizOrgAplyLsnPlanDscr3}" not_null="true" alert_name="활용계획 및 기대효과"></textarea>
                    </td>
                </tr>
                <tr>
                    <th scope="row">희망강사</th>
                    <td th:text="${content[0].bizOrgAplyLsnPlanEtcInstr}"></td>
                    <th scope="row">확정강사</th>
                    <td th:if="${#lists.isEmpty(content[0].bizInstructorAplies)}"></td>
                    <td th:unless="${#lists.isEmpty(content[0].bizInstructorAplies)}">
                        <th:block th:each="item3:${content[0].bizInstructorAplies}">
                            <span th:if="${item3.bizInstrAplyStts == 2}" class="mx-1" th:text="${item3.bizInstrAplyInstrNm}"></span>
                        </th:block>
                    </td>
                </tr>
                <tr>
                    <th scope="row">건의사항(기타의견)</th>
                    <td colspan="3" th:text="${content[0].bizOrgAplyLsnPlanEtc}"></td>
                </tr>
                <tr th:if="${content[0].bizPbancMaster.bizPbancPeprYn==1}">
                    <th scope="row">e-NIE(온라인 뉴스활용교육) 프로그램 신청 여부</th>
                    <td colspan="3">
                        <div class="radio_box">
                            <input id="peprY" type="radio" name="bizOrgAplyPeprYn" th:checked="${content[0].bizOrgAplyPeprYn==1}">
                            <label for="peprY">
                                <span></span>
                                신청
                            </label>
                        </div>
                        <div class="radio_box">
                            <input id="peprN" type="radio" name="bizOrgAplyPeprYn" th:checked="${content[0].bizOrgAplyPeprYn==0}">
                            <label for="peprN">
                                <span></span>
                                미신청
                            </label>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="bl_gridBtns">
            <div class="bl_gridBtns_rgt">
                <a th:onclick="update()" class="btn btnDefault btnRegister">수정</a>
                <a href="/business/organization/apply" class="btn btnDefault btnList">목록</a>
                <a href="#popChangeOfApproval" data-control="modal" data-handler="popChangeOfApproval" class="btn btnDefault approval_popup">반려</a>
            </div>
        </div>

        <div class="iframe_wrap">
            <iframe id="changeBusiness" src="about:blank" width="1000"></iframe>
        </div>

        <div class="iframe_wrap">
            <iframe id="findUser" src="about:blank" width="1000"></iframe>
        </div>
    </div>
    <div sec:authorize="!isAuthenticated()"></div>
    <!-- POPUP : 승인변경 -->
    <article class="pop_wrapper ui-modal" id="popChangeOfApproval">
        <div class="pop_wrap pop_secondary">
            <div class="pop_head">
                <div class="tit">승인변경</div>
            </div>
            <div class="pop_cont">
                <p class="mb-20">해당 신청을 반려하시겠습니까?</p>

                <div class="tableLeftResponsive">
                    <table class="tableLeft">
                        <colgroup>
                            <col style="width: 200px">
                            <col style="width: auto">
                        </colgroup>
                        <tbody>
                        <tr>
                            <th scope="row">반려사유</th>
                            <td>
                                <input id="bizOrgAplySttsCmnt" type="text">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- GRID : BUTTON -->
                <div class="bl_gridBtns">
                    <div class="bl_gridBtns_md">
                        <a class="btn btnDefault" th:onclick="reject()">확인</a>
                    </div>
                </div>
            </div>
            <button type="button" class="pop_close pop-close">닫기</button>
        </div>
    </article>

    <th:block layout:fragment="script">
        <script th:inline="javascript">
            var bizPbancMaxTm=0;
            var bizStts =true;

            // 강의확인서 있으면 수정 불가
            let CONT = [[${content}]]
            $(".dtl_list").each((i, item)=>{
                if(CONT[0].bizOrganizationAplyDtls[i].bizInstructorIdentifyDtls.length >0){
                    $(item).find("input").each((i2, item2)=>{
                        $(item2).attr("disabled","true")
                    })

                    $(item).find("select").each((i2, item2)=>{
                        $(item2).attr("disabled","true")
                    })

                    $(item).find(".btn_del").each((i2, item2)=>{
                        $(item2).remove()
                    })
                }
            })

            function toggleTime() {
                if (document.getElementById("bizOrgAplyTimeFrst").disabled == true) {
                    document.getElementById("bizOrgAplyTimeFrst").disabled = false;
                } else {
                    document.getElementById("bizOrgAplyTimeFrst").disabled = true;
                }
            }

            $('.bizOrgAplyLsnDtlHr').each(function(index, item){
                $(item).change(function (){changeDtlHr(this)})
            })
            //수업시수 검사
            function changeDtlHr(input){
                if($(input).val()<2){
                    alert("수업시수는 2보다 커야 합니다.")
                    $(input).val(2)
                }
                totalClassTimeSet();
            }
            function totalClassTimeSet() {
                let totalClassTime = 0;
                for (let i = 0; i < $('.bizOrgAplyLsnDtlHr').length; i++) {
                    totalClassTime = Number(totalClassTime);
                    totalClassTime += Number($('.bizOrgAplyLsnDtlHr')[i].value);
                }
                if(bizPbancMaxTm!=0){
                    if(parseInt(totalClassTime)>bizPbancMaxTm){
                        totalClassTime = Number(bizPbancMaxTm);
                        alert("총 교육시간이 사업공고의 최대 시간보다 큽니다. 수업시수를 확인해 주세요.");
                        $('#bizOrgAplyTime').attr('value', totalClassTime);
                        return false
                    }
                }
                $('#bizOrgAplyTime').attr('value', totalClassTime);
                if(bizStts){
                    $("#bizOrgAplyTimeFrst").attr('value', totalClassTime);
                }
                return true;
            }

            function update(){
                if($('.bizOrgAplyLsnDtlYmd') != '' && $('.bizOrgAplyLsnDtlYmd') != null){
                    for (let i = 0; i < $('.bizOrgAplyLsnDtlYmd').length; i++) {
                        var pickDate = $('.bizOrgAplyLsnDtlYmd')[i].value ;
                        var pickShour = $('.bgng1')[i].value ;
                        var pickEhour= $('.end1')[i].value ;
                        var pickSmin= $('.bgng2')[i].value ;
                        var pickEmin= $('.end2')[i].value ;
                        for(let g = 0; g < $('.bizOrgAplyLsnDtlYmd').length; g++){
                            if(g != i && i<g ){
                                if($('.bizOrgAplyLsnDtlYmd')[g].value == pickDate){
                                    for(c = pickShour; c <= pickEhour ; c++){ // i의 pickdata 1시간씩 흐름.
                                        if(c != pickShour && c<10 && c != "00"){
                                            c = "0"+c;
                                        }
                                        console.log('c= ',c)
                                        console.log('bgng1= ',$('.bgng1')[g].value)
                                        console.log('end1= ',$('.end1')[g].value)
                                        console.log('i',i)
                                        if(c == $('.bgng1')[g].value || c == $('.end1')[g].value){ // i의 시간이 b의 시간과 동일할때
                                            if(c != pickEhour){
                                                alert("수업일정 중 "+ pickDate +" 날짜에 중복된 수업일정이 있습니다. 재확인 해주세요.123");
                                                return false;
                                            }
                                            if(pickEmin >= $('.bgng2')[g].value){// 분단위 체크
                                                for(var z = $('.bgng2')[g].value; z <= $('.end2')[g].value; z++){
                                                    if(z == pickSmin || z == pickEmin){
                                                        alert("수업일정 중 "+ pickDate +" 날짜에 중복된 수업일정이 있습니다. 재확인 해주세요.345")
                                                        return false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if(nullCheck()){
                    if(checkTimes() < 1) {
                        let params = getFormData();
                        if(params.bizOrgAplyTime> bizPbancMaxTm){
                            if(confirm('총 교육시간이 사업공고의 최대시간보다 큽니다. 정말로 수정하시겠습니까?')){
                                sendData(params)
                            }
                        }else{
                            sendData(params)
                        }
                    } else alert("수업시간표의 종료시간과 시작시간의 차이가 최소시간 미만인 회차가 있습니다. 재확인 해주세요.")
                }
            }
            function checkTimes(){
                var start = 0;
                var end = 0;
                var check = 0;
                $(".dtl_list").each(function (index, item){
                    start = ($(this).find(".bgng1").val() * 60) + $(this).find(".bgng2").val()
                    end = ($(this).find(".end1").val() * 60) + $(this).find(".end2").val()
                    if ((end - start) < 30) check += 1
                })
                return check;
            }
            function sendData(params){
                $.ajax({
                    type: "put",
                    headers: {'Content-Type' : 'application/json'},
                    url: "/api/business/organization/apply/update",
                    data: JSON.stringify(params),
                    dataType: "json",
                    success: function (data){
                        let dtlData = getDtlData(data.bizOrgAplyNo)
                        let check = getDtlOrig();
                        if(dtlData.length==0){
                            alert("성공적으로 수정되었습니다.")
                            window.location.reload();
                        }else{
                            dtlData.forEach(item=>{
                                if(item.bizOrgAplyDtlNo !="BOAD0000000"){
                                    $.ajax({
                                        type: "put",
                                        headers: {'Content-Type' : 'application/json'},
                                        url: `/api/business/organization/apply/detail/update`,
                                        data: JSON.stringify(item),
                                        async:false,
                                        dataType: "json",
                                    })
                                }else{
                                    $.ajax({
                                        type: "post",
                                        headers: {'Content-Type' : 'application/json'},
                                        url: `/api/business/organization/apply/detail/create`,
                                        data: JSON.stringify(item),
                                        async:false,
                                        dataType: "json",
                                    })
                                }
                                if(item ==dtlData[dtlData.length-1]){
                                    alert("강의확인서가 작성되지 않은 수업일정이 성공적으로 수정되었습니다.")
                                    window.location.reload();
                                }
                            })
                        }
                    },
                    error: function (e){
                        alert(e.responseJSON.resultMessage);
                    }
                })
            }
            /* <![CDATA[ */
            function getDtlData(bizOrgAplyNo){
                let itemArray = [];
                let temp = {}
                $(".dtl_list").each(function (index, item){
                    temp ={bizOrgAplyNo : bizOrgAplyNo}
                    temp.bizOrgAplyLsnDtlEtc = $(this).find(".bizOrgAplyLsnDtlEtc").val();
                    temp.bizOrgAplyLsnDtlHr = parseInt($(this).find(".bizOrgAplyLsnDtlHr").val());
                    temp.bizOrgAplyLsnDtlNope =parseInt($(this).find(".bizOrgAplyLsnDtlNope").val());
                    temp.bizOrgAplyLsnDtlPlc = $(this).find(".bizOrgAplyLsnDtlPlc").val();
                    temp.bizOrgAplyLsnDtlRnd = parseInt($(this).find(".bizOrgAplyLsnDtlRnd").val());
                    temp.bizOrgAplyLsnDtlTpic = $(this).find(".bizOrgAplyLsnDtlTpic").val();
                    temp.bizOrgAplyLsnDtlYmd = $(this).find(".bizOrgAplyLsnDtlYmd").val();
                    temp.bizOrgAplyLsnDtlBgngTm = $(this).find(".bgng1").val()+":"
                    temp.bizOrgAplyLsnDtlBgngTm += $(this).find(".bgng2").val()=="0"?"00":$(this).find(".bgng2").val();
                    temp.bizOrgAplyLsnDtlBgngTm = temp.bizOrgAplyLsnDtlBgngTm.replace("60", "00");
                    temp.bizOrgAplyLsnDtlEndTm = $(this).find(".end1").val()+":"
                    temp.bizOrgAplyLsnDtlEndTm += $(this).find(".end2").val()=="0"?"00":$(this).find(".end2").val();
                    temp.bizOrgAplyLsnDtlEndTm = temp.bizOrgAplyLsnDtlEndTm.replace("60", "00");
                    temp.bizOrgAplyDtlNo = $(this).find(".bizOrgAplyDtlNo").val()!='' ? $(this).find(".bizOrgAplyDtlNo").val() :"BOAD0000000";
                    itemArray.push(temp)
                })
                return itemArray;
            }
            function getDtlOrig(){
                let CONT =  [[ ${content} ]];
                return CONT[0].bizOrganizationAplyDtls;
            }
            function getFormData(){
                let CONT =  [[ ${content} ]];
                let params = {};
                params.bizPbancMaxTm = CONT[0].bizPbancMaster.bizPbancMaxTm;
                params.bizInstructor = CONT[0].bizInstructor;
                params.bizOrgAplyChgYn =  CONT[0].bizOrgAplyChgYn;
                params.bizOrgAplyFile = CONT[0].bizOrgAplyFile;
                params.bizOrgAplyPeprYn = $("input:radio[name=bizOrgAplyPeprYn]:checked").attr('id') == 'peprY'?1:0;
                params.bizOrgAplyLsnPlanBgng = $("#date1").val();
                params.bizOrgAplyLsnPlanEnd = $("#date2").val();
                params.bizOrgAplyLsnPlanDscr1 = $("#bizOrgAplyLsnPlanDscr1").val();
                params.bizOrgAplyLsnPlanDscr2 = $("#bizOrgAplyLsnPlanDscr2").val();
                params.bizOrgAplyLsnPlanDscr3 = $("#bizOrgAplyLsnPlanDscr3").val();
                params.bizOrgAplyLsnPlanEtc = $("#bizOrgAplyLsnPlanEtc").val();
                params.bizOrgAplyLsnPlanEtcInstr = $("#bizOrgAplyLsnPlanEtcInstr").val();
                params.bizOrgAplyLsnPlanNope = $("#bizOrgAplyLsnPlanNope").val();
                if(CONT[0].bizPbancMaster.bizPbancType==1){
                    params.bizOrgAplyLsnPlanTrgt = new Array($("[name=applicationType]:checked").length);
                    $("[name=applicationType]:checked").each((index,item)=>{
                        params.bizOrgAplyLsnPlanTrgt[index] = $(item).val();
                    })
                    params.bizOrgAplyLsnPlanTrgt = params.bizOrgAplyLsnPlanTrgt.toString()
                    if($("#type11[name=applicationType]:checked").length==1){
                        params.bizOrgAplyLsnPlanTrgt+=$("#type10").val()!=""?$("#type10").val() : "기타";
                    }
                    if(params.bizOrgAplyLsnPlanTrgt==""){
                        params.bizOrgAplyLsnPlanTrgt="-"
                    }
                }else if(CONT[0].bizPbancMaster.bizPbancType==2 || CONT[0].bizPbancMaster.bizPbancType==3){
                    params.bizOrgAplyLsnPlanTrgt =$("input:radio[name=trgt]:checked").val() ? $("input:radio[name=trgt]:checked").val() : "";
                    params.bizOrgAplyLsnPlanTrgt += $("#bizOrgAplyLsnPlanTrgt").val();
                }else{
                    params.bizOrgAplyLsnPlanTrgt = $("#bizOrgAplyLsnPlanTrgt").val();
                }
                params.bizOrgAplyNo = CONT[0].bizOrgAplyNo;
                params.bizOrgAplyOperCtgr = $("#bizOrgAplyOperCtgr").text()?$("#bizOrgAplyOperCtgr").text():'-';
                params.bizOrgAplyOperMeth =  ($("#bizOrgAplyOperMeth").val().startsWith('교과수업') || $("#bizOrgAplyOperMeth").val().startsWith('기타')) && $("#bizOrgAplyOperMethEtc").val() ? $("#bizOrgAplyOperMeth").val() + '_' + $("#bizOrgAplyOperMethEtc").val() : $("#bizOrgAplyOperMeth").val();
                params.bizOrgAplyPic = $("#bizOrgAplyPic").val();
                params.bizOrgAplyPicEml = $("#bizOrgAplyPicEml").val();
                params.bizOrgAplyPicJbgd =  $("#bizOrgAplyPicJbgd").val();
                params.bizOrgAplyPicMpno =  $("#bizOrgAplyPicMpno").val();
                params.bizOrgAplyPicTelno =  $("#bizOrgAplyPicTelno").val();
                params.bizOrgAplyPicNm =  $("#bizOrgAplyPicNm").val();
                params.bizOrgAplyRgn =  $("#selectRegion").val();
                params.bizOrgAplyRprsvNm =  $("#bizOrgAplyRprsvNm").val() ? $("#bizOrgAplyRprsvNm").val() : "";
                params.bizOrgAplyStts =  CONT[0].bizOrgAplyStts;
                params.bizOrgAplySttsCmnt =  '-';
                params.bizOrgAplyTime = $("#bizOrgAplyTime").val();
                params.bizOrgAplyTimeFrst = $("#bizOrgAplyTimeFrst").val();
                params.bizPbancNo=$("#bizPbancNo").text();
                params.orgCd=CONT[0].orgCd;
                return params;
            }
            function reject(){
                let CONT =  [[ ${content} ]];
                CONT[0].bizOrgAplySttsCmnt= $("#bizOrgAplySttsCmnt").val();
                CONT[0].bizOrgAplyStts = 3;
                $.ajax({
                    type: "put", //http method
                    url: `/api/business/organization/apply/update`, //값을 가져올 경로
                    headers: {'Content-Type': 'application/json'},
                    data: JSON.stringify(CONT[0]),
                    dataType: "json",
                    success: function(data) {
                        alert("수정이 완료되었습니다.");
                        window.location.reload();
                    },
                    error: function(e) { }
                })
            }

            function onLoadSubmit() {
                console.log('commonCode: ', [[ ${commonCode} ]] )
                methEtc($(bizOrgAplyOperMeth).val())

                let CONT = [[ ${content} ]];
                bizPbancMaxTm = CONT[0].bizPbancMaster.bizPbancMaxTm ? CONT[0].bizPbancMaster.bizPbancMaxTm  : 0;
                if(CONT[0].bizOrgAplyStts==2){
                    bizStts = false;
                }

                if(CONT != null){
                    $('#date1').datepicker("setDate", new Date(CONT[0].bizOrgAplyLsnPlanBgng) );
                    $('#date2').datepicker("setDate", new Date(CONT[0].bizOrgAplyLsnPlanEnd) );
                }
                sortPlanDtl()
                $(".bizOrgAplyLsnDtlYmd").each((index, item)=>{
                    $(item).datepicker("option", "onClose", ( ) =>{
                        planDtl()
                    });
                })
                CONT[0].bizOrganizationAplyDtls.forEach((item,index) => {
                    setSelected(item.bizOrgAplyLsnDtlBgngTm.substring(0,2), 'startHour'+index);
                    if(item.bizOrgAplyLsnDtlBgngTm.substring(3,5) == '00'){
                        setSelected(0, 'startMin'+index);
                    } else {
                        setSelected(item.bizOrgAplyLsnDtlBgngTm.substring(3,5), 'startMin'+index);
                    }
                    setSelected(item.bizOrgAplyLsnDtlEndTm.substring(0,2), 'endHour'+index);
                    if(item.bizOrgAplyLsnDtlEndTm.substring(3,5) == '00'){
                        setSelected(0, 'endMin'+index);
                    } else {
                        setSelected(item.bizOrgAplyLsnDtlEndTm.substring(3,5), 'endMin'+index);
                    }

                })
                // setSelected(CONT)

                //지역 selected
                setSelected(CONT[0].bizOrgAplyRgn, 'selectRegion');
            }

            /**
             * 수업시간표 Row 동적 생성
             * @returns {*}
             */
            function makeScheduleTr(cloneTarget){
                cloneTarget = cloneTarget ? cloneTarget : $(`
                        <tr class="dtl_list">
                            <td>
                                <input type="hidden" class="common_input bizOrgAplyDtlNo" value="">
                                <input type="hidden" class="common_input temp" value="">
                                <input type="text" class="hp_w120 bizOrgAplyLsnDtlRnd" not_null="true" alert_name="수업시간표 회차" reg_type="int">
                            </td>
                            <td>
                                <input type="text" class="hp_w150 el_datePicker bizOrgAplyLsnDtlYmd" not_null="true" alert_name="수업시간표 수업일정" reg_type="date">
                            </td>
                            <td>
                                <input type="text" class="hp_w150 bizOrgAplyLsnDtlTpic" not_null="true" alert_name="수업시간표 수업주제">
                            </td>
                            <td>
                                <input type="number" min="2" class="bizOrgAplyLsnDtlHr"  oninput="this.value=this.value.replace(/[^-0-9]/g,'');" not_null="true" alert_name="수업시간표 수업시수" reg_type="int">
                            </td>
                            <td>
                                <div class="time_select">
                                    <select class="common_select bgng1" data-list="hourList"  not_null="true" alert_name="수업시간표 시작시간"></select>
                                    <select class="common_select bgng2" data-list="minuteList" not_null="true" alert_name="수업시간표 시작시간"></select>
                                </div>
                            </td>
                            <td>
                                <div class="time_select">
                                    <select class="common_select end1" data-list="hourList"  not_null="true" alert_name="수업시간표 종료시간"></select>
                                    <select class="common_select end2" data-list="minuteList" not_null="true" alert_name="수업시간표 종료시간"></select>
                                </div>
                            </td>
                            <td>
                                <input type="text" class="hp_w120 bizOrgAplyLsnDtlNope" not_null="true" alert_name="수업시간표 수업인원" reg_type="int">
                            </td>
                            <td>
                                <input type="text" class="hp_w120 bizOrgAplyLsnDtlPlc" not_null="true" alert_name="수업시간표 수업장소">
                            </td>
                            <td>
                                <input type="text" class="hp_w150 bizOrgAplyLsnDtlEtc">
                            </td>
                            <td>
                                -
                            </td>
                            <td>
                                <a href="javascript: void(0)" class="btn_type3 btn_add" onclick="addField(this)">추가</a>
                                <a href="javascript: void(0)" class="btn_type3 btn_del" onclick="delField(this)">삭제</a>
                            </td>
                        </tr>
                    `);

                cloneTarget.find(".el_datePicker").each(function(idx,el){
                    let getYear=new Date().getFullYear();
                    CommonUI.datePicker(el);
                    $(el).datepicker( "option", "maxDate", `${getYear}-11-30` )
                    $(el).datepicker("option", "onClose", function ( selectedDate ) {
                        planDtl();
                    })
                })
                cloneTarget.find(".common_select").each(function(idx, el){
                    CommonUI.dataListSelectBox(el);
                })

                cloneTarget.find('.bizOrgAplyLsnDtlHr').each(function(idx, el){
                    $(el).change(function (){changeDtlHr(this)})
                })
                return cloneTarget[0];
            }

            //날짜 순으로 정렬
            function sortPlanDtl(){
                let n = $('.bizOrgAplyLsnDtlYmd').length;
                let nowDate, nextDate;
                let nowTime, nextTime;
                for (let i=n-1; i>0; i--) {
                    for (let j=0; j<i; j++) {
                        nowDate=$('.bizOrgAplyLsnDtlYmd')[j].value;
                        nextDate=$('.bizOrgAplyLsnDtlYmd')[j+1].value;
                        if (nowDate > nextDate) {
                            moveDown($('.bizOrgAplyLsnDtlYmd')[j])
                        }else if(nowDate==nextDate){
                            // 같은 날이면 시작 시간 순으로 정렬
                            nowTime = $(".bgng1")[j].value;
                            nextTime=$('.bgng1')[j+1].value;
                            if(nowTime>nextTime){
                                moveDown($('.bizOrgAplyLsnDtlYmd')[j])
                            }
                        }
                    }
                    if(i==1){
                        dtlRnd();
                    }
                }

            }

            //아래행과 위치변경
            function moveDown(el){
                let $tr = $(el).parent().parent();
                $tr.next().after($tr);
            }


            //수업기간에 따른 교육기간 설정
            function planDtl(){
                let dtlDate = new Array( $('.bizOrgAplyLsnDtlYmd').length);
                $('.bizOrgAplyLsnDtlYmd').each((index, item)=>{
                    dtlDate[index] = $(item).val()==""? null:$(item).val();
                })
                let maxDate = "2000-00-00"
                let minDate = "3000-00-00";
                for(let i=0; i<dtlDate.length; i++){
                    if(dtlDate[i]<minDate){
                        minDate=dtlDate[i];
                    }
                    if(dtlDate[i]>maxDate){
                        maxDate=dtlDate[i];
                    }
                    if((i+1)==dtlDate.length){
                        $('#date1').val(minDate);
                        $('#date2').val(maxDate);
                    }
                }
                sortPlanDtl()
            }

            //수업시수 검사
            function changeDtlHr(input){
                if($(input).val()<2){
                    alert("수업시수는 2보다 커야 합니다.")
                    $(input).val(2)
                }
                totalClassTimeSet();
            }


            function dtlRnd(){
                $(".bizOrgAplyLsnDtlRnd").each((index,item)=>{
                    $(item).val(index+1);
                })
            }
            function addField(btn_add){

                // node 선택
                let cloneDiv = btn_add ? btn_add.parentElement.parentElement : $("#bizScheduleTbody");

                // 노드 복사하기 (deep copy)
                let newDiv = makeScheduleTr();

                // input 값 초기화
                let input = newDiv.querySelectorAll('input');
                if(cloneDiv){
                    let cloneInput = $(cloneDiv).find('input');
                    let count=0;
                    input.forEach(item => {
                        if($(item).attr('type')!="hidden"){
                            item.value = cloneInput[count].value;
                        }
                        count+=1;
                    })
                }else{
                    input.forEach(item => {
                        item.value = '';
                    })
                }

                // select 값 초기화
                let select = newDiv.querySelectorAll('select');
                if(cloneDiv){
                    let cloneSelect= $(cloneDiv).find('select');
                    let count=0;

                    if($(cloneSelect[0]).val()!=0){
                        $(select[2]).removeAttr('disabled');
                        $(select[3]).removeAttr('disabled');
                    }
                    select.forEach(item => {
                        for (let i = 0; i < item.options.length; i++) {
                            item.options[i].removeAttribute('selected');
                        }
                        if( $(cloneSelect[count]).val() ){
                            $(item).val($(cloneSelect[count]).val()).prop("selected", true);
                            count++;
                        }
                    })
                }else{
                    select.forEach(item => {
                        for (let i = 0; i < item.options.length; i++) {
                            item.options[i].removeAttribute('selected');
                        }
                        if( item.options.length ){
                            item.options[0].setAttribute('selected', true);
                        }
                        if($(item).attr("data-list")=="minuteList"){
                            $(item).val("60").prop("selected", false);
                            $(item).val("00").prop("selected", true);
                        }
                    })
                }

                // 복사한 노드 붙여넣기
                cloneDiv.after(newDiv);
                dtlRnd();
                totalClassTimeSet();
            }

            function delField(btn_del){
                let CONT =  [[ ${content} ]];
                let table = btn_del.parentElement.parentElement.parentElement.parentElement;
                let trlist = table.querySelectorAll('tr.dtl_list');

                if (trlist.length == 1) { // 삭제 버튼 1개일 때(테이블 리스트 1개일 때)
                    alert('현재 수업시간표가 1회차라서 삭제할 수 없습니다.')
                    return;
                }

                if(confirm("정말로 삭제하시겠습니까? 새로고침해도 복구되지 않습니다.")){
                    let data =getDtlOrig();
                    let tr = $(btn_del).parent().parent();
                    let index = $(tr).find(".bizOrgAplyDtlIndex").val();
                    if(index && index!=''){
                        $.ajax({
                            type: "delete",
                            headers: {'Content-Type' : 'application/json'},
                            url: `/api/business/organization/apply/detail/delete/${data[index].bizOrgAplyDtlNo}`,
                            data: JSON.stringify(data[index]),
                            dataType: "json",
                            success:function (data){
                                btn_del.parentElement.parentElement.remove();
                                totalClassTimeSet();
                                dtlRnd();
                                planDtl();

                                CONT[0].bizOrgAplyTime = $("#bizOrgAplyTime").val();
                                CONT[0].bizOrgAplyLsnPlanBgng =$('#date1').val();
                                CONT[0].bizOrgAplyLsnPlanEnd =$('#date2').val();
                                $.ajax({
                                    type: "put",
                                    headers: {'Content-Type' : 'application/json'},
                                    url: "/api/business/organization/apply/update",
                                    data: JSON.stringify(CONT[0]),
                                    dataType: "json",
                                    success: function (data){
                                        alert('수업시간표가 삭제되었습니다.')
                                    },error:function (e){
                                        alert('수업시간표를 삭제하고 총 교육시간을 반영하는 과정에서 오류가 발생하였습니다. 하단의 수정하기 버튼을 눌러주세요.');
                                    }
                                })

                            },
                            error:function (e){
                                alert(e.responseJSON.resultMessage);
                            }
                        })
                    }else{
                        btn_del.parentElement.parentElement.remove();
                        totalClassTimeSet();
                        dtlRnd();
                        planDtl();
                    }
                }
            }

            function findOrgUser() {
                if (confirm("담당자를 변경하시겠습니까?")) {
                    let CON = [[${content[0]}]];
                    let organizationCode = CON.orgCd

                    if (organizationCode) {
                        openPop('', '/popup/find/user?organizationCode='+organizationCode, 'findUser')
                    }
                }
            }

            function methEtc(val) {
                $('#bizOrgAplyOperMethEtc').hide()
                if (val == '교과수업' || val == '기타') {
                    $('#bizOrgAplyOperMethEtc').show()
                } else {
                    $('#bizOrgAplyOperMethEtc').hide()
                }
            }

            function checkPbanc() { // 이게 최선임, 누르기 전에는 확인이 어려움
                let CON = [[${content[0]}]];
                let bizPbancMaster = CON.bizPbancMaster;
                $.ajax({
                    type: "post",
                    headers: {'Content-Type': 'application/json'},
                    url: `/api/business/pbanc/list/checkInstr`,
                    data: JSON.stringify(bizPbancMaster),
                    dataType: "json",
                    success: function (data) {
                        if (data.resultCode == "3605") { // 강사 모집에 없으면 그냥 제공
                            openPop('', '/popup/find/pbanc?notBizPbancStts=9', 'changeBusiness');
                        } else { // 강사 모집에 있으면 알려줌
                            alert("강사 모집에 등록된 사업 공고 입니다. 변경할 사업 공고도 같은 강사 모집에 등록해 주세요.");
                            openPop('', '/popup/find/pbanc?notBizPbancStts=9', 'changeBusiness');
                        }
                    },
                    error: function (e) { }
                })
            }

            function setPopData(popData){
                if(popData && popData != null){
                    if (popData.bizPbancNo) {
                        if($('#bizPbancNo').text() == popData.bizPbancNo){
                            alert('이미 선택된 사업공고입니다.');
                        }else{
                            let bizData = {};
                            bizData.bizPbancNo = popData.bizPbancNo
                            $.ajax({
                                type: "post",
                                headers: {'Content-Type': 'application/json'},
                                url: `/api/business/pbanc/list/checkInstr`,
                                data: JSON.stringify(bizData),
                                dataType: "json",
                                success: function (data) {
                                    if (data.resultCode == "3605") { // 강사 모집에 없으면 알려줌
                                        alert('변경할 사업 공고를 선택했습니다.\n변경 전 사업 공고가 강사 모집 공고에 등록되어 있으면 변경한 사업 공고도 같이 등록해 주세요.');
                                    } else { // 강사 모집에 있으면 그냥 제공
                                        alert('변경할 사업 공고를 선택했습니다.\n변경 전 사업 공고가 선택한 사업공고와 같은 강사 모집 공고에 있는지 확인해주세요.');
                                    }
                                    $('#bizPbancNm').text(popData.bizPbancNm);
                                    $('#bizPbancNo').text(popData.bizPbancNo);
                                },
                                error: function (e) { }
                            })
                        }
                    } else if(popData.userId) {
                        $.ajax({
                            type: "get",
                            headers: {'Content-Type': 'application/json'},
                            url: `/api/user/web/authority/page?userId=`+popData.userId,
                            dataType: "json",
                            success: function (data) {
                                if(data.content[0].businessAuthorityApprovalState=="2") {
                                    var authData = data.content[0].organizationAuthorityHistory
                                    $('#bizOrgAplyRprsvNm').val(authData.representation); // 기관 대표자명
                                    $('#bizOrgAplyPicJbgd').val(authData.rank); // 담당자 직급
                                    $('#bizOrgAplyPicTelno').val(authData.telNo); // 담당자 전화번호
                                } else {
                                    alert("승인된 권한 내역이 없습니다. '사용자 관리 > 권한 관리 > 회원 권한'을 확인해주세요.");
                                }
                            },
                            error: function (e) { }
                        })

                        $('#bizOrgAplyPic').val(popData.userId);
                        $('#bizLicenseNumber').val(popData.organizationInfo.bizLicenseNumber);
                        $('#organizationName').val(popData.organizationInfo.organizationName);
                        $('#bizOrgAplyPicNm').val(popData.userName);
                        $('#bizOrgAplyPicEml').val(popData.email);
                        $('#bizOrgAplyPicMpno').val(popData.phone);
                    }
                }
            }

            window.addEventListener('message', handleDocHeightMsg, false); // 메시지 수신 이벤트 등록
            function handleDocHeightMsg(eventObj) { // 메시지 수신 처리를 위한 함수
                setPopData(eventObj.data);
            }
            /* ]]> */
        </script>
    </th:block>
</div>
</body>
</html>
