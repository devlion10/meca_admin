<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/default_layout}">
<body>
<div layout:fragment="content" data-menu="business-1">
  <div sec:authorize="isAuthenticated()">
    <div class="title">
      <h2>사업공고 관리</h2>
    </div>

    <div class="tableLeftResponsive">
      <table class="tableLeft">
        <colgroup>
          <col style="width: 200px">
          <col style="width: auto">
          <col style="width: 200px">
          <col style="width: auto">
        </colgroup>
        <tbody>
        <tr>
          <th scope="row"><span class="el_required">*</span>구분</th>
          <td colspan="3">
            <div class="radio_box">
              <input id="businessCategory1" type="radio" name="flexRadioDefault1" th:if="${content != null}" th:checked="${content[0].bizPbancCtgr == 0}" onclick="toggle_subCtgr(0)">
              <input id="businessCategory1" type="radio" name="flexRadioDefault1" th:unless="${content != null}" checked onclick="toggle_subCtgr(0)">
              <label for="businessCategory1">
                <span></span>
                미디어교육
              </label>
            </div>
            <div class="radio_box">
              <input id="businessCategory2" type="radio" name="flexRadioDefault1" th:if="${content != null}" th:checked="${content[0].bizPbancCtgr == 1}" onclick="toggle_subCtgr(1)">
              <input id="businessCategory2" type="radio" name="flexRadioDefault1" th:unless="${content != null}" onclick="toggle_subCtgr(1)">
              <label for="businessCategory2">
                <span></span>
                언론인연수
              </label>
            </div>
            <div class="radio_box">
              <input id="businessCategory3" type="radio" name="flexRadioDefault1" th:if="${content != null}" th:checked="${content[0].bizPbancCtgr == 2}" onclick="toggle_subCtgr(2)">
              <input id="businessCategory3" type="radio" name="flexRadioDefault1" th:unless="${content != null}" onclick="toggle_subCtgr(2)">
              <label for="businessCategory3">
                <span></span>
                미디어지원
              </label>
            </div>
          </td>
        </tr>
        <!-- 세부 구분 -->
        <tr name="subCtgr">
          <th scope="row"><span class="el_required">*</span>세부 구분</th>
          <td colspan="3">
            <div class="radio_box">
              <input id="bizPbancCtgrSub1" type="radio" name="radioSub1" th:if="${content != null}" th:checked="${content[0].bizPbancCtgrSub == 1}">
              <input id="bizPbancCtgrSub1" type="radio" name="radioSub1" th:unless="${content != null}">
              <label for="bizPbancCtgrSub1">
                <span></span>
                사회미디어
              </label>
            </div>
            <div class="radio_box">
              <input id="bizPbancCtgrSub2" type="radio" name="radioSub1" th:if="${content != null}" th:checked="${content[0].bizPbancCtgrSub == 2}">
              <input id="bizPbancCtgrSub2" type="radio" name="radioSub1" th:unless="${content != null}">
              <label for="bizPbancCtgrSub2">
                <span></span>
                학교미디어
              </label>
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>사업명</th>
          <td colspan="3">
            <input type="text" id="businessName" class="hp_w600" th:value="${content == null ? '자유형' : content[0].bizPbancNm}" not_null="true" alert_name="사업명" >
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>최대시간</th>
          <td colspan="3">
            <input id="bizPbancMaxTm" type="text" class="hp_w400" th:value="${content == null ? 0 : content[0].bizPbancMaxTm}" not_null="true" alert_name="최대시간" reg_type="int">
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>사업년도</th>
          <td>
            <input type="text" id="businessYear" class="hp_w400" th:value="${content == null ? #calendars.format(#calendars.createNow(), 'yyyy') : content[0].bizPbancYr}" not_null="true" alert_name="사업년도" >
          </td>
          <th scope="row"><span class="el_required">*</span>신청 가능 수</th>
          <td>
            <input type="text" id="businessMax" class="hp_w400" th:value="${content == null ? 0 : content[0].bizPbancMaxInst}" not_null="true" alert_name="사업참여기관" reg_type="int">
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>선정방식</th>
          <td colspan="3">
            <div class="radio_box">
              <input id="businessSelect1" type="radio" name="flexRadioDefault2" th:if="${content != null}" th:checked="${content[0].bizPbancSlctnMeth == 0}">
              <input id="businessSelect1" type="radio" name="flexRadioDefault2" th:unless="${content != null}">
              <label for="businessSelect1">
                <span></span>
                승인
              </label>
            </div>
            <div class="radio_box">
              <input id="businessSelect2" type="radio" name="flexRadioDefault2" th:if="${content != null}" th:checked="${content[0].bizPbancSlctnMeth == 1}">
              <input id="businessSelect2" type="radio" name="flexRadioDefault2" th:unless="${content != null}">
              <label for="businessSelect2">
                <span></span>
                선착순
              </label>
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>접수기간</th>
          <td colspan="3">
            <div class="bl_dateRange">
              <input type="text" id="date1" class="el_datePicker sdate" not_null="true" alert_name="접수기간 시작일" reg_type="date">
              <span class="blank">~</span>
              <input type="text" id="date2" class="el_datePicker edate" not_null="true" alert_name="접수기간 종료일" reg_type="date">
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>사업기간</th>
          <td colspan="3">
            <div class="bl_dateRange">
              <input type="text" id="date3" class="el_datePicker sdate" not_null="true" alert_name="사업기간 시작일" reg_type="date">
              <span class="blank">~</span>
              <input type="text" id="date4" class="el_datePicker edate" not_null="true" alert_name="사업기간 종료일" reg_type="date">
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>결과발표일</th>
          <td colspan="3">
            <div class="d-flex-2">
              <div class="radio_box">
                <input id="Undetermined" type="radio" name="Announcement" th:if="${content != null}" th:checked="${content[0].bizPbancRsltYmd == '1900-01-01'}">
                <input id="Undetermined" type="radio" name="Announcement" th:unless="${content != null}">
                <label for="Undetermined">
                  <span></span>
                  미정
                </label>
              </div>
              <div class="radio_box">
                <input id="date" type="radio" name="Announcement" th:if="${content != null}" th:checked="${content[0].bizPbancRsltYmd != '1900-01-01'}">
                <input id="date" type="radio" name="Announcement" th:unless="${content != null}">
                <label for="date">
                  <span></span>
                  일자
                </label>
              </div>
              <input id="AnnouncementDate" type="text" class="el_datePicker flex-grow-0" th:unless="${content != null}" disabled>
              <input id="AnnouncementDate" type="text" class="el_datePicker flex-grow-0" th:if="${content != null}" th:disabled="${content[0].bizPbancRsltYmd == '1900-01-01'}">
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>사업내용</th>
          <td colspan="3">
            <textarea name="contents" class="ckeditor" style="width:100%; height:200px" th:text="${content == null ? '' : content[0].bizPbancCn}"></textarea>
          </td>
        </tr>

        <tr>
          <th scope="row"><span class="el_required">*</span>담당자연락처</th>
          <td colspan="3">
            <input id="addr" type="text" class="hp_w400" th:value="${content == null ? '' : content[0].bizPbancPicTel}" not_null="true" alert_name="담당자 연락처" >
          </td>
        </tr>
        <tr> <!-- 파일첨부 API 5 -->
          <th scope="row">파일첨부</th>
          <td colspan="3">
            <div class="bl_uploadList__scroll hp_w600">
              <ul class="bl_uploadList" th:if="${(content != null) && (content[0].fileMasters != null)}">
                <li th:each="item, index: ${content[0].fileMasters}">
                  <a th:href="@{/api/common/upload/download(attachFilePath=${item.filePath})}" class="download_ajax" th:text="${item.originalFileName}"></a>
                  <div class="bl_uploadList_rgt">
                    <span class="file_size" th:text="${item.fileSize}"></span>
                    <a class="file_delete" th:href="@{/api/common/upload/delete/{sn}(sn=${item.fileSn})}" th:value="${index.index}">
                      <i class="fas fa-times color_red"></i>
                    </a>
                  </div>
                </li>
              </ul>
              <ul class="bl_uploadList" th:unless="${(content != null) && (content[0].fileMasters != null)}">

              </ul>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-2 hp_w600">
              <div class="d-flex gap-2 align-items-center">
                <div class="bl_uploadGrid">
                  <div class="bl_upload js_upload me-0">
                    <label for="formFile" class="btn btnDefault bg-secondary text-white bl_upload_btn">파일찾기</label>
                    <input id="formFile" type="file" name="file" class="bl_upload_file js_file" accept=".gif, .jpg, .png, .pdf, .hwp, .hwpx, .doc, .docx, .ppt, .pptx, .xls, .xlsx, .zip">
                  </div>
                </div>
                <p class="bl_uploadNote">※ 파일형식 gif, jpg, png, pdf, hwp, doc, docx, ppt, pptx, xls, xlsx, zip / 5MB 미만</p>
              </div>
              <p id="fileSize" class="bl_uploadNote">총용량: <span id="fileMB">0</span>MB</p>
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>상태</th>
          <td colspan="3">
            <div class="radio_box">
              <input id="businessState9" value="9" type="radio" name="flexRadioDefault3" th:if="${content != null}" th:checked="${content[0].bizPbancStts == 9}">
              <input id="businessState9" value="9" type="radio" name="flexRadioDefault3" th:unless="${content != null}" checked>
              <label for="businessState9">
                <span></span>
                임시저장
              </label>
            </div>
            <div class="radio_box">
              <input id="businessState1" value="0" type="radio" name="flexRadioDefault3" th:if="${content != null}" th:checked="${content[0].bizPbancStts == 0}">
              <input id="businessState1" value="0" type="radio" name="flexRadioDefault3" th:unless="${content != null}">
              <label for="businessState1">
                <span></span>
                모집중
              </label>
            </div>
            <div class="radio_box">
              <input id="businessState2" value="1" type="radio" name="flexRadioDefault3" th:if="${content != null}" th:checked="${content[0].bizPbancStts == 1}">
              <input id="businessState2" value="1" type="radio" name="flexRadioDefault3" th:unless="${content != null}">
              <label for="businessState2">
                <span></span>
                모집마감
              </label>
            </div>
          </td>
        </tr>
        <tr>
          <th scope="row"><span class="el_required">*</span>상단 고정 여부</th>
          <td colspan="3">
            <div class="radio_box">
              <input id="top_Y" value="Y" type="radio" name="radioTopYn" th:if="${content != null}" th:checked="${content[0].isTop == 'Y'}">
              <input id="top_Y" value="Y" type="radio" name="radioTopYn" th:unless="${content != null}">
              <label for="top_Y">
                <span></span>
                Y
              </label>
            </div>
            <div class="radio_box">
              <input id="top_N" value="N" type="radio" name="radioTopYn" th:if="${content != null}" th:checked="${content[0].isTop == 'N'}">
              <input id="top_N" value="N" type="radio" name="radioTopYn" th:unless="${content != null}" checked>
              <label for="top_N">
                <span></span>
                N
              </label>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <br>
    <div class="bl_gridBtns mb-3">
      <div class="bl_gridBtns_lft">
        <select id="addTemplate" class="common_select">
          <option value="0">(미디어)미디어강사 선발</option>
          <option value="1">(언론인)국내자율연수</option>
          <option value="2">(언론인)해외장기연수</option>
          <option value="3">(언론인)세계뉴스미디어총회</option>
          <option value="3">(언론인)해외 언론교류 프로그램</option>
          <option value="4">(언론인)저널리즘 카페/특강</option>
          <option value="5">(언론인)신문사지원사업</option>
          <option value="6">(언론인)기획취재지원사업</option>
          <option value="7">(언론인)약자프렌들리</option>
          <option value="8">(언론인)단체지원</option>
        </select>
        <div onclick="addTemplate()" class="btn btnDefault btn_add">템플릿 추가</div>
      </div>
      <div class="bl_gridBtns_rgt">
        <div class="btn btnDefault btn_add" onclick="addField(null)">항목 추가</div>
        <div class="btn btnDefault state__blue" onclick="makeOrder()">순서정렬</div>
      </div>
    </div>
    <p class="bl_uploadNote mb-1">※ 신청자명, 소속기관, 부서명, 직위, 연락처(전화,메일)은 공통 양식입니다. 미디어 강사의 경우 소속기관, 부서명, 직위는 선택값입니다. </p>
    <div class="tableLeftResponsive">
      <table class="tableLeft" id="bizPbancTmpl5">
        <colgroup>
          <col style="width: 5%">
          <col style="width: 15%">
          <col style="width: 10%">
          <col style="width: 23%">
          <col style="width: 45%">
        </colgroup>
        <tbody id="bizOrgAply">
        <tr>
          <th scope="row">
            <input name="bizPbancTmpl5Ordr" type="hidden" value="0">
            <span class="el_required">*</span>순서
          </th>
          <th scope="row">
            <span class="el_required">*</span>사업신청서 항목 명
          </th>
          <th scope="row">
            <span class="el_required">*</span>필수입력여부
          </th>
          <th scope="row">
            <span class="el_required">*</span>입력 타입
          </th>
          <th scope="row">
            입력안내문
          </th>
        </tr>
        <th:block th:if="${content == null}">
          <tr name="bizPbancTmpl5">
            <td class="text-center">
              <input name="bizPbancTmpl5Ordr" class="text-center" type="text" not_null="true" alert_name="사업신청서 항목 순서" value="1" onchange="tmplOrder(this)">
            </td>
            <td>
              <input name="bizPbancTmpl5Name" type="text" not_null="true" alert_name="사업신청서 항목 명">
            </td>
            <td>
              <select name="bizPbancTmpl5Notnull" class="common_select">
                <option value="N">필수아님</option>
                <option value="Y">필수</option>
              </select>
            </th>
            <td>
              <div class="d-flex align-items-center gap-2">
                <select name="bizPbancTmpl5Type" class="common_select" onchange="customChange(this)">
                  <option value="1">단답형</option>
                  <option value="2">서술형</option>
                  <option value="3">단일선택</option>
                  <option value="6">다중선택(체크박스)</option>
                  <option value="4">날짜</option>
                  <option value="5">파일</option>
                </select>
                <input name="bizPbancTmpl5TypeSlct" type="text" placeholder="선택지 입력 | 로 항목 구분" maxlength="300" disabled>
              </div>
            </th>
            <td>
              <div class="d-flex align-items-center gap-2">
                <input name="bizPbancTmpl5Etc" type="text" placeholder="입력창 하단에 안내 '※ ' 기본 포함" maxlength="500">
                <div class="btn btnDefault btnDelete btn_del" onclick="delField(this)">삭제</div>
              </div>
            </th>
          </tr>
        </th:block>
        <th:block th:if="${content!=null && !#lists.isEmpty(content[0].bizPbancTmpl5)}">
          <tr name="bizPbancTmpl5" th:each="item, stat : ${content[0].bizPbancTmpl5}">
            <td class="text-center">
              <input class="text-center" name="bizPbancTmpl5No" th:value="${item.bizPbancTmpl5No}" type="hidden">
              <input name="bizPbancTmpl5Ordr" class="text-center" type="text" th:value="${item.bizPbancTmpl5Ordr}" not_null="true" alert_name="사업신청서 항목 순서" value="1" onchange="tmplOrder(this)">
            </td>
            <td>
              <input name="bizPbancTmpl5Name" type="text" not_null="true" alert_name="사업신청서 항목 명" th:value="${item.bizPbancTmpl5Name}">
            </td>
            <td>
              <select name="bizPbancTmpl5Notnull" class="common_select">
                <option th:selected="${item.bizPbancTmpl5Notnull=='N'}" value="N">필수아님</option>
                <option th:selected="${item.bizPbancTmpl5Notnull=='Y'}" value="Y">필수</option>
              </select>
            </th>
            <td>
              <div class="d-flex align-items-center gap-2">
                <select name="bizPbancTmpl5Type" class="common_select" onchange="customChange(this)">
                  <option th:selected="${item.bizPbancTmpl5Type=='1'}" value="1">단답형</option>
                  <option th:selected="${item.bizPbancTmpl5Type=='2'}" value="2">서술형</option>
                  <option th:selected="${item.bizPbancTmpl5Type=='3'}" value="3">단일선택</option>
                  <option th:selected="${item.bizPbancTmpl5Type=='6'}" value="6">다중선택(체크박스)</option>
                  <option th:selected="${item.bizPbancTmpl5Type=='4'}" value="4">날짜</option>
                  <option th:selected="${item.bizPbancTmpl5Type=='5'}" value="5">파일</option>
                </select>
                <input name="bizPbancTmpl5TypeSlct" type="text" placeholder="선택지 입력 | 로 항목 구분" maxlength="300" th:value="${item.bizPbancTmpl5TypeSlct}" th:disabled="${!(item.bizPbancTmpl5Type=='3'||item.bizPbancTmpl5Type=='6')}">
              </div>
            </th>
            <td>
              <div class="d-flex align-items-center gap-2">
                <input th:if="${item.bizPbancTmpl5Type=='5'}" name="bizPbancTmpl5Etc" type="text" placeholder="입력창 하단에 안내 '※ 파일 크기 5MB 이하, ' 기본 포함" maxlength="500" th:value="${item.bizPbancTmpl5Etc}">
                <input th:unless="${item.bizPbancTmpl5Type=='5'}" name="bizPbancTmpl5Etc" type="text" placeholder="입력창 하단에 안내 '※ ' 기본 포함" maxlength="500" th:value="${item.bizPbancTmpl5Etc}">
                <div class="btn btnDefault btnDelete btn_del" onclick="delField(this)">삭제</div>
              </div>
            </th>
          </tr>
        </th:block>
        </tbody>
      </table>
    </div>
    <!-- GRID : BUTTON -->
    <div class="bl_gridBtns">
      <div class="bl_gridBtns_rgt">
        <a class="btn btnDefault btnList" href="/business/pbanc/list">목록</a>
        <div th:if="${content == null}" class="btn btnDefault" th:onclick="checkForm('create')">등록</div>
        <div th:unless="${content == null}" class="btn btnDefault" th:onclick="checkForm('update')">수정</div>
      </div>
    </div>

  </div>

  <th:block layout:fragment="script">
    <script th:inline="javascript">
      function customChange(select){
        if(select.value=="3"||select.value=="6"){
          $(select).find("+input[type=text]").removeAttr("disabled");
        }else if(select.value=="5") {
          $(select).attr("placeholder", "입력창 하단에 안내 \'※ 파일 크기 5MB 이하, \' 기본 포함")
        } else{
          $(select).find("+input[type=text]").attr("disabled", true);
          $(select).find("+input[type=text]").val("");
          $(select).attr("placeholder", "입력창 하단에 안내 \'※ \' 기본 포함")
        }
      }
      function toggle_subCtgr(value) {
        if(value==1){
          $('tr[name=subCtgr]').hide();
        } else {
          $('tr[name=subCtgr]').show();
        }
      }

      function checkForm(flag){
        if(nullCheck()){
          makeOrder()
          let result = true;
          if($('input:radio[name=flexRadioDefault1]:checked').length==0){
            result = false;
            alert('사업구분을 선택해 주세요.');
          }else if($('input:radio[name=flexRadioDefault2]:checked').length ==0){
            result = false;
            alert('선정방식을 선택해 주세요.');
          }else if($('input:radio[name=Announcement]:checked').length ==0){
            result = false;
            alert('결과발표일을 선택해 주세요.');
          }else if(CKEDITOR.instances.contents.getData()==''){
            result = false;
            alert('사업내용을 작성해 주세요.');
          }else if($('input:radio[name=flexRadioDefault3]:checked').length ==0){
            result = false;
            alert('상태를 선택해 주세요.');
          }
          if(result && flag=='create'){
            create();
          }else if(result && flag=='update'){
            update();
          }
        }
      }
      //파일첨부API1
      let fileSize = $(".file_size");

      for (var item of fileSize) {
        if(Math.floor(item.innerText / 1024)>1024){
          let temp = Math.floor(item.innerText / 1024);
          temp = parseFloat(temp);
          temp = parseFloat(temp / 1024);
          temp = temp.toFixed(2);
          $(item).text(temp+"MB")
        }else{
          $(item).text(Math.floor(item.innerText / 1024)+"KB")
        }
      };
      var fileList=[];

      $("#formFile").bind("change", function (e){
        if(this.files[0]){
          fileList.push(this.files[0])

          //총용량 추가
          let text = this.files[0].size;
          text = parseFloat(text) / 1024;
          text = parseFloat(text) / 1024;
          text = text.toFixed(2);
          let now = $('#fileMB').text();
          now = parseFloat(now)+parseFloat(text);
          now = parseFloat(now).toFixed(2);
          $('#fileMB').text(now);
        }
      })
      /* <![CDATA[ */
      function getFormData(){
        let CONT = [[ ${content}]];

        let params ={};
        params.bizPbancNo=0;
        params.bizPbancTmpl5ApiRequestVO = [];

        $("#bizPbancTmpl5 tr[name=bizPbancTmpl5]").each((index,tr)=>{
          let temp = {};
          temp.bizPbancTmpl5No = $(tr).find("[name=bizPbancTmpl5No]").val()? $(tr).find("[name=bizPbancTmpl5No]").val(): null;
          temp.bizPbancTmpl5Ordr = $(tr).find("[name=bizPbancTmpl5Ordr]").val();
          temp.bizPbancTmpl5Name = $(tr).find("[name=bizPbancTmpl5Name]").val();
          temp.bizPbancTmpl5Notnull = $(tr).find("[name=bizPbancTmpl5Notnull]").val();
          temp.bizPbancTmpl5Type = $(tr).find("[name=bizPbancTmpl5Type]").val();
          if(temp.bizPbancTmpl5Type=="3"||temp.bizPbancTmpl5Type=="6") temp.bizPbancTmpl5TypeSlct = $(tr).find("[name=bizPbancTmpl5TypeSlct]").val();
          if($(tr).find("[name=bizPbancTmpl5Etc]").val().trim()!='') temp.bizPbancTmpl5Etc = $(tr).find("[name=bizPbancTmpl5Etc]").val();
          params.bizPbancTmpl5ApiRequestVO.push(temp)
        })


        params.bizPbancType = 5;
        params.bizPbancCtgr = $('input:radio[name=flexRadioDefault1]:checked').attr("id")=="businessCategory3"?2:$('input:radio[name=flexRadioDefault1]:checked').attr("id")=="businessCategory2"?1:0;
        params.bizPbancCtgrSub = $('input:radio[name=radioSub1]:checked').attr("id")=="bizPbancCtgrSub1"?1:2;
        params.bizPbancNm = $("#businessName").val();
        params.bizPbancYr = parseInt($("#businessYear").val());
        params.bizPbancMaxInst = parseInt($("#businessMax").val());
        params.bizPbancRcptBgng = $("#date1").val();
        params.bizPbancRcptEnd = $("#date2").val();
        params.bizPbancSprtBgng = $("#date3").val();
        params.bizPbancSprtEnd = $("#date4").val();
        params.bizPbancRsltYmd = $('input:radio[name=Announcement]:checked').attr("id")=="Undetermined"? "1900-01-01" :$("#AnnouncementDate").val();
        params.bizPbancPicTel = $("#addr").val();
        params.bizPbancStts = $('input:radio[name=flexRadioDefault3]:checked').attr("value");
        params.bizPbancSlctnMeth = $('input:radio[name=flexRadioDefault2]:checked').attr("id")=="businessSelect1"?0:1; //선정방식
        params.bizPbancInstrSlctnMeth= $('input:radio[name=businessAssignment]:checked').attr("id")=="businessAssignment1"?0:$('input:radio[name=businessAssignment]:checked').attr("id")=="businessAssignment3"?9:1; //선정방식
        params.bizPbancMaxTm=parseInt($("#bizPbancMaxTm").val());
        params.isTop = $('input:radio[name=radioTopYn]:checked').attr("value");

        let contents = CKEDITOR.instances.contents.getData();
        params.bizPbancCn = contents? contents:"내용에 오류가 발생했습니다.";

        return params
      }

      //파일첨부API2
      $(".file_delete").bind("click", function (e){
        e.preventDefault();
        if(confirm("정말로 파일을 삭제하시겠습니까?")){
          let CONT = [[ ${content}]];
          let index = $(this).attr("value")*1 ? $(this).attr("value")*1:0;
          let url = $(this).attr("href")
          $.ajax({
            type: "delete", //http method
            url: url, //값을 가져올 경로
            headers: {'Content-Type': 'application/json'},
            data: JSON.stringify(CONT[0].fileMasters[index]),
            dataType: "json",
            success: function(data) {
              alert("삭제되었습니다.")
            },
            error: function(data) {
              alert("오류가 발생했습니다.")
            }
          })
          //총용량 계산
          let text= $(this).parent().find('.file_size').text()
          text = text.replace("KB", "");
          text =  parseInt(text) / 1024;
          text = text.toFixed(2);
          let now = $('#fileMB').text();
          now = parseFloat(now)-parseFloat(text);
          now = parseFloat(now).toFixed(2);
          $('#fileMB').text(now);
          $(this).parent().parent().remove();
        }
      })

      function create(){

        let params = getFormData();
        /** 콘텐츠 등록*/
        $.ajax({ //jquery ajax
          type: "post", //http method
          url: "/api/business/pbanc/list/create", //값을 가져올 경로
          headers: {'Content-Type': 'application/json'},
          data: JSON.stringify(params),
          dataType: "json",
          success: function(data) {
            //파일첨부API3
            if(fileList.length>0){
              fileList.forEach((f) => {
                if(f != null){
                  let form = new FormData();
                  form.append( "attachFile", f );
                  $.ajax({
                    type:"put", //http method
                    url:`/api/common/upload/attach/${data.bizPbancNo}?attachType=PBANC`, //값을 가져올 경로
                    processData : false,
                    contentType : false,
                    async:false,
                    data: form,
                    success: function(data) {   //요청 성공시 실행될 메서드
                    }, error: function(e) {
                      alert(e.responseJSON.resultMessage);
                    }
                  })
                }
                if(f == fileList[fileList.length-1]){
                  alert("사업공고가 등록되었습니다.");
                  window.location.replace('/business/pbanc/list');
                }
              })
            }else{
              alert("사업공고가 등록되었습니다.");
              window.location.replace('/business/pbanc/list');
            }
          },
          error:function (e){
            if(e && e.responseJSON && e.responseJSON.resultMessage){
              alert(e.responseJSON.resultMessage);
            }else{
              alert('등록하는 과정에서 오류가 발생했습니다.');
            }
          }
        })
      }

      function update(){
        const CONT = [[ ${content}]];
        let params = getFormData();
        params.bizPbancNo = CONT[0].bizPbancNo;
        params.bizPbancCtgrSub = CONT[0].bizPbancCtgrSub;

        /** 콘텐츠 수정*/
        $.ajax({ //jquery ajax
          type: "put", //http method
          url: "/api/business/pbanc/list/update", //값을 가져올 경로
          headers: {'Content-Type': 'application/json'},
          data: JSON.stringify(params),
          dataType: "json",
          success: function(data) {
            if(params.bizPbancTmpl5ApiRequestVO!=null && params.bizPbancTmpl5ApiRequestVO.length>0 ){

              //템플릿 수정
              $.ajax({
                type: "put", //http method
                url: `/api/business/pbanc/list/tmpl/5/update/${params.bizPbancNo}`, //값을 가져올 경로
                headers: {'Content-Type': 'application/json'},
                data: JSON.stringify(params.bizPbancTmpl5ApiRequestVO),
                dataType: "json",
                success: function(data) {
                  if(fileList.length==0){
                    alert("사업공고가 수정되었습니다.");
                    window.location.reload(); // 새로고침
                  }
                },
                error:function (e){
                  if(e && e.responseJSON && e.responseJSON.resultMessage){
                    alert(e.responseJSON.resultMessage);
                  }else{
                    alert('수정하는 과정에서 오류가 발생했습니다.');
                  }
                }
              })
            }else if( params.bizPbancTmpl5ApiRequestVO.length==0 && fileList.length==0){
              alert("사업공고가 수정되었습니다.");
              window.location.reload(); // 새로고침
            }
            //파일첨부API4
            //파일추가
            if(fileList.length>0){
              for (f of fileList){
                if(f != null){
                  let form = new FormData();
                  form.append( "attachFile", f );
                  $.ajax({
                    type:"put", //http method
                    url:`/api/common/upload/attach/${data.bizPbancNo}?attachType=PBANC`, //값을 가져올 경로
                    processData : false,
                    contentType : false,
                    async:false,
                    data: form,
                    success: function(data) { },  //요청 성공시 실행될 메서드
                    error: function(e) {
                      if(e && e.responseJSON && e.responseJSON.resultMessage){
                        alert(e.responseJSON.resultMessage);
                      }else{
                        alert('수정하는 과정에서 오류가 발생했습니다.');
                      }
                    }
                  })
                }
                if(f == fileList[fileList.length-1]){
                  alert("사업공고가 수정되었습니다.");
                  window.location.reload(); // 새로고침
                }
              }
            }

          },
          error:function (e){
            if(e && e.responseJSON && e.responseJSON.resultMessage){
              alert(e.responseJSON.resultMessage);
            }else{
              alert('수정하는 과정에서 오류가 발생했습니다.');
            }
          }
        })

      }

      /** 행 이동 */
      function moveRow(object) {
        const row = $(object).closest('tr');
        if(object.getAttribute("name") == "up" && row.find('[name=bizPbancTmpl5Ordr]').val()!=1) { row.prev().before(row); }
        else if(object.getAttribute("name") == "down") { row.next().after(row); }
        makeOrder()
      }
      function tmplOrder(input){
        if(isNaN(Number(input.value)) || Number(input.value)<1){
          input.value="";
          alert('0보다 큰 숫자를 숫자만 입력해 주세요.')
        }else{
          let tr = $('#bizOrgAply').find('tr').get();
          tr.sort(function (a, b) {
            let val1 = Number($(a).find('[name=bizPbancTmpl5Ordr]').val());
            let val2 = Number($(b).find('[name=bizPbancTmpl5Ordr]').val());
            return (val1 > val2)?1 : -1;
          })
          $('#bizOrgAply').html(tr)
        }
      }

      function makeOrder(){
        $("#bizOrgAply input[name=bizPbancTmpl5Ordr]").each((index, item)=>{
          if($(item).val()!='0') $(item).val(index)
        })
      }

      function addTemplate(){
        let count = Number($("#addTemplate").val())
        let tmplate =[
          [ // 일반/ 미디어교육	미디어교육	강사 선발
            {bizPbancTmpl5Name:"성별",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"1"},
            {bizPbancTmpl5Name:"최종학력",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"1"},
            {bizPbancTmpl5Name:"지역",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"3"},
            {bizPbancTmpl5Name:"교육가능대상",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"3"},
            {bizPbancTmpl5Name:"교육가능분야",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"3"},
            {bizPbancTmpl5Name:"지원서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"개인정보처리동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	언론인연수	지역 언론인 국내 자율연수 지원 사업
            {bizPbancTmpl5Name:"지원신청서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"자기소개 및 언론경력",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"연수계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"개인정보처리방침동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"입학허가서",bizPbancTmpl5Notnull:"N", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"등록금 고지서",bizPbancTmpl5Notnull:"N", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"재직증명서",bizPbancTmpl5Notnull:"N", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	언론인연수	해외장기연수 지원 사업
            {bizPbancTmpl5Name:"자기소개 및 언론경력",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"연수주제 관련 실적",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"연수계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"개인정보처리방침동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"입학허가서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공인어학증명서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	언론인연수	세계뉴스미디어총회(WNMC) 한·미 언론교류 프로그램 한국 참가자 공모 한·호 언론교류 프로그램 한국 참가자 공모
            {bizPbancTmpl5Name:"언론계 활동 경력",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"참가계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"개인정보처리방침동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"참가자의무사항이행확약서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	언론인연수	저널리즘 카페 찾아가는 저널리즘 특강
            {bizPbancTmpl5Name:"지원신청서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"참가자 명단",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"개인정보수집이용동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	미디어교육	신문사 지원사업
            {bizPbancTmpl5Name:"사업계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"예산산출내역",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"개인정보수집이용동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	미디어교육	기획취재지원사업
            {bizPbancTmpl5Name:"언론사 개요",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"보도분야",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"6", bizPbancTmpl5TypeSlct:"일반연재|디지털 스토리텔링|실감형(VR/AR)보도"},
            {bizPbancTmpl5Name:"취재계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"법인등기부등본 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"사업자등록증 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"방송사업 허가승인등록증 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"국세완납증명서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"지방세완납증명서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"개인정보수집이용동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"편집독자위설치증빙",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	미디어교육	약자프렌들리
            {bizPbancTmpl5Name:"언론사 개요",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"보도분야",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"6", bizPbancTmpl5TypeSlct:"일반 연재 기획보도|디지털 스토리텔링 보도"},
            {bizPbancTmpl5Name:"취재계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"법인등기부등본 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"사업자등록증 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"정기간행믈 등록증 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"국세완납증명서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"지방세완납증명서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"개인정보수집이용동의서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
          [ // 언론인	미디어교육	단체지원
            {bizPbancTmpl5Name:"언론사 개요",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"2"},
            {bizPbancTmpl5Name:"보도분야",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"6", bizPbancTmpl5TypeSlct:"세미나|출판|행사"},
            {bizPbancTmpl5Name:"취재계획서",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"공문",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5",bizPbancTmpl5Etc:"직인 필요"},
            {bizPbancTmpl5Name:"법인등기부등본 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"사업자등록증 사본",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"고유번호증",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
            {bizPbancTmpl5Name:"최근보도물",bizPbancTmpl5Notnull:"Y", bizPbancTmpl5Type:"5"},
          ],
        ]
        if(tmplate[count]){
          for(let i=0; i<tmplate[count].length; i++){
            addField(tmplate[count][i])
          }
        }

      }
      function addField(data){
        let count = $("tr[name=bizPbancTmpl5]").length+1;
        let tr = $(`
        <tr name="bizPbancTmpl5">
          <td class="text-center">
            <input class="text-center" name="bizPbancTmpl5No" type="hidden">

            <input class="text-center" value="${count}" name="bizPbancTmpl5Ordr" type="text" not_null="true" alert_name="사업신청서 항목 순서" onchange="tmplOrder(this)">
          </td>
          <td>
            <input name="bizPbancTmpl5Name" type="text" not_null="true" alert_name="사업신청서 항목 명">
          </td>
          <td>
            <select name="bizPbancTmpl5Notnull" class="common_select">
              <option value="N">필수아님</option>
              <option value="Y">필수</option>
            </select>
          </th>
          <td>
            <div class="d-flex align-items-center gap-2">
            <select name="bizPbancTmpl5Type" class="common_select" onchange="customChange(this)">
              <option value="1">단답형</option>
              <option value="2">서술형</option>
              <option value="3">단일선택</option>
              <option value="6">다중선택(체크박스)</option>
              <option value="4">날짜</option>
              <option value="5">파일</option>
            </select>
            <input name="bizPbancTmpl5TypeSlct" type="text" placeholder="선택지 입력 | 로 항목 구분" maxlength="300" disabled>
            </div>
          </th>
          <td>
            <div class="d-flex align-items-center gap-2">
              <input name="bizPbancTmpl5Etc" type="text" placeholder="입력창 하단에 안내 '※ ' 기본 포함" maxlength="500">
              <div class="btn btnDefault btnDelete btn_del" onclick="delField(this)">삭제</div>
            </div>
          </th>
        </tr>`)
        if(data!=null){
          $(tr).find("[name=bizPbancTmpl5No]").val(data.bizPbancTmpl5No);
          $(tr).find("[name=bizPbancTmpl5Name]").val(data.bizPbancTmpl5Name);
          $(tr).find("[name=bizPbancTmpl5Notnull]").val(data.bizPbancTmpl5Notnull);
          $(tr).find("[name=bizPbancTmpl5Type]").val(data.bizPbancTmpl5Type);
          $(tr).find("[name=bizPbancTmpl5Etc]").val(data.bizPbancTmpl5Etc);
          if(data.bizPbancTmpl5Type == "3"||data.bizPbancTmpl5Type == "6"){
            $(tr).find("[name=bizPbancTmpl5TypeSlct]").val(data.bizPbancTmpl5TypeSlct);
            $(tr).find("[name=bizPbancTmpl5TypeSlct]").removeAttr("disabled");
          }
          if(data.bizPbancTmpl5Type == "5"){
            $(tr).find("[name=bizPbancTmpl5Etc]").attr("placeholder", "입력창 하단에 안내 \'※ 파일 크기 5MB 이하, \' 기본 포함");
          }
        }
        $("#bizOrgAply").append(tr);
      }

      function delField(e){
        const TARGET = e.parentElement.parentElement.parentElement;
        TARGET.remove();
        makeOrder()
      }

      function onLoadSubmit() {
        console.log('commonCode: ', [[ ${commonCode} ]] )
        const CONT = [[ ${content}]];

        if(CONT != null){
          // 호출된 값에서 각각 날짜를 뽑아와야 함
          $('#date1').datepicker("setDate", new Date(CONT[0].bizPbancRcptBgng) );
          $('#date2').datepicker("setDate", new Date(CONT[0].bizPbancRcptEnd) );
          $('#date3').datepicker("setDate", new Date(CONT[0].bizPbancSprtBgng) );
          $('#date4').datepicker("setDate", new Date(CONT[0].bizPbancSprtEnd) );
          if(CONT[0].bizPbancRsltYmd!='1900-01-01'){
            $('#date').parent().next().removeAttr('disabled');
            $('#AnnouncementDate').datepicker("setDate", new Date(CONT[0].bizPbancRsltYmd) );
          }
          if(CONT[0].bizPbancCtgrSub==0){
            $('tr[name=subCtgr]').hide();
          } else {
            $('tr[name=subCtgr]').show();
          }
          //제출한 사업신청서가 있으면 신청서 양식 삭제불가 
          if(CONT[0].bizOrganizationAplyCount>0 || CONT[0].bizOrganizationAprvCount>0){
            $("#bizOrgAply div.btn_del").remove();
          }
        }

        //총용량 계산1
        $(".file_size").each((index, item)=>{
          let text = $(item).text();
          if(text.indexOf('KB')==-1){
            text = text.replace("MB", "");
            text = parseFloat(text)
          }else{
            text = text.replace("KB", "");
            text = parseFloat(text) / 1024;
            text = text.toFixed(2);
          }
          let now = $('#fileMB').text();
          now = parseFloat(now)+parseFloat(text);
          now = parseFloat(now).toFixed(2);
          $('#fileMB').text(now);
        })

      }

      // 결과발표일 항목 - 일자 선택시 datepicker 활성화
      $('input[name="Announcement"]').change(function(){
        if ($('#date:checked').val() == 'on') {
          $('#date').parent().next().removeAttr('disabled');
        } else {
          $('#date').parent().next().attr('disabled', 'disabled');
        }
      })
      /* ]]> */
    </script>
  </th:block>
  <div sec:authorize="!isAuthenticated()"></div>
</div>
</body>
</html>
