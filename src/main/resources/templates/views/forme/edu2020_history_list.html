<!-- FORME 강의확인서 목록 -->
<th:block layout:fragment="style">
    <style>
        #forme_lec_history_pop .transcolor.odd td{background:#fff;}
        #forme_lec_history_pop .transcolor.even td{background:#f9f9f9;}
        #forme_lechistory_list_wrap tr.active td{ background: #b4daff !important;}
    </style>
</th:block>
<div id="forme_lechistory">

    <div class="bl_boardCtrls">
        <div class="bl_boardCtrls_lft">
            <h3 class="subTitle"><span id="forme_lechistory_title_user" style="color:red;"></span> 언론인교육센터 수강이력</h3>
        </div>
        <div class="bl_boardCtrls_rgt">
            <select class="common_select no-change-event" data-list="countSortList"></select>
        </div>
    </div>
    <div class="tableResponsive overflowMulti">
        <table class="table">
            <thead>
            <tr>
                <th rowspan="2" scope="col">신청번호</th>  <!--crsRqstSeq-->
                <th rowspan="2" scope="col">강의대분류</th> <!--crsCls1Nm-->
                <th rowspan="2" scope="col">강의소분류</th> <!--crsCls2Nm-->
                <th rowspan="2" scope="col">강의명</th> <!--crsNm-->
                <th rowspan="2" scope="col">강의기간</th> <!--crsFrmtoDt-->
                <th rowspan="2" scope="col">상태</th> <!--crsRqstStatNm-->
                <th rowspan="2" scope="col">수료일자</th> <!--cmpltDt2-->
                <th colspan="6" scope="col">신청자정보</th> <!--cmpltDt2-->
            </tr>
            <tr>
                <th scope="col">이름</th> <!--userNm-->
                <th scope="col">성별</th><!-genderNm--->
                <th scope="col">매체사명</th><!--mdiaNm-->
                <th scope="col">매체명</th><!--mdiaDNm-->
                <th scope="col">부서</th><!--deptNm-->
                <th scope="col">직급</th><!--mdiaDNm-->
            </tr>
            </thead>
            <tbody id="forme_lechistory_list_wrap">
            <tr>
                <td>번호</td>
                <td>작성자</td>
                <td>제출처</td>
                <td>년도</td>
                <td>사업명</td>
                <td>차수</td>
                <td>수행기관</td>
                <td>강의기간</td>
                <td>강의시간</td>
                <td>언택트 강의 포함유무</td>
                <td>년월</td>
                <td>승인</td>
                <td>작성일</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div id="forme_lechistory_list_wrap_paginate" class="bl_paginate"></div>
</div>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        function initialEdu2020(formeUserId) {
            let pageInfo = {
                page: 0,
                size: $("#forme_lechistory .common_select").val() || 50,
                userId: formeUserId,//userId
                onClick: function (pageIndex) {
                    if (pageIndex !== undefined) {
                        pageInfo.page = pageIndex;
                        getFormeEdu2020HistoryList(formeUserId, (pageIndex - 1));
                    }
                }
            }

            $(document).ready(function(){
                $("#forme_lechistory .common_select").off("change").change(function(e){
                    e.preventDefault();
                    pageInfo.size = $("#forme_lechistory .common_select").val() || 50;
                    getFormeEdu2020HistoryList(formeUserId, 0)
                });
            });


            function formePaginationInfo(data) {
                let result = {
                    page: data.pageable.pageNumber,
                    size: $("#forme_lechistory .common_select").val(),
                    totalPages: data.totalPages,
                    first: data.first,
                    last: data.last,
                    totalElements: data.totalElements
                }
                return result;
            }

            function getFormeEdu2020HistoryList(userId, pageIndex = 0) {
                if (pageIndex != undefined) {
                    pageInfo.page = pageIndex;
                }
                $.ajax({
                    type: "get",
                    headers: {'Content-Type': 'application/json'},
                    url: "/api/education/application/journalismschool",
                    data: pageInfo,
                    dataType: "json",
                    success: function (data) {
                        if (data && data.content && data.content) formeLecHistoryListMakeItem(data.content, data);
                        pageInfo = Object.assign(pageInfo, formePaginationInfo(data));
                        paginationAjax($("#forme_lechistory_list_wrap_paginate").get(0), pageInfo);
                    }
                });
            }

            function formeLecHistoryListMakeItem(list, data) {
                let frag = $(document.createDocumentFragment());
                if ($("#edu2020_count").length && data) {
                    $("#edu2020_count").text(data.totalElements + '건');
                    $("#forme_lechistory_title_user").text(formeUserId+"님");
                }
                list.forEach(function (item) {
                    let wrDate = moment(item.blciRegDttm).format("YYYY-MM-DD");
                    let YYYYMM = moment(item.blciYymm + "01").format("YYYY년 MM월");
                    let tr = $(`
                    <tr>
                        <td>${ctsUtil.checkNull(item.crsRqstSeq, '')}</td>
                        <td>${ctsUtil.checkNull(item.crsCls1Nm, '')}</td>
                        <td>${ctsUtil.checkNull(item.crsCls2Nm, '')}</td>
                        <td>${ctsUtil.checkNull(item.crsNm, '')}</td>
                        <td>${ctsUtil.checkNull(item.crsFrmtoDt, '')}</td>
                        <td>${ctsUtil.checkNull(item.crsRqstStatNm, '')}</td>
                        <td>${ctsUtil.checkNull(item.cmpltDt2, '')}</td>
                        <td>${ctsUtil.checkNull(item.userNm, '')}</td>
                        <td>${ctsUtil.checkNull(item.genderNm, '')}</td>
                        <td>${ctsUtil.checkNull(item.mdiaNm,'')}</td>
                        <td>${ctsUtil.checkNull(item.mdiaDNm,'')}</td>
                        <td>${ctsUtil.checkNull(item.deptNm,'')}</td>
                        <td>${ctsUtil.checkNull(item.dutyNm,'')}</td>
                    </tr>
                    `);
                    tr.click(function (e) {
                        tr.addClass("active").siblings().removeClass("active");
                    });
                    frag.append(tr);
                });
                if( !list.length ){
                    let tr = $(`<tr><td class="text-center" colspan="13">수강이력이 없습니다.</td></tr>`);
                    frag.html(tr);
                }
                $('#forme_lechistory_list_wrap').empty().append(frag);
            }

            getFormeEdu2020HistoryList(formeUserId);
        }
    </script>
</th:block>
